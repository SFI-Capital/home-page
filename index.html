<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SFI Club - Cộng Đồng Tài Chính Chuyên Nghiệp</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Inter cho cảm giác hiện đại và dễ đọc -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Thư viện Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        /* Thiết lập font Inter cho toàn bộ body */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Chế độ tối: Màu sắc chuyên nghiệp (Corporate Dark Theme) */
        .dark-mode {
            background-color: #0f172a;
            /* Slate 900 - Nền sâu hơn */
            color: #e2e8f0;
            /* Text sáng nhẹ */
        }

        .dark-mode .card {
            background-color: #1e293b;
            /* Slate 800 - Nền card đậm */
            border-color: #334155;
            /* Slate 700 - Viền tinh tế */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }

        /* === ĐỊNH NGHĨA MÀU SẮC === */
        .text-primary {
            color: #0f7aef;
        }

        .border-primary {
            border-color: #0f7aef;
        }

        .bg-accent {
            background-color: #6ce3ff;
            /* Xanh Ngọc */
        }

        .hover\:bg-accent-dark:hover {
            background-color: #00b0d8;
            /* Xanh Ngọc đậm hơn cho hover */
        }

        .text-note {
            color: #fcd878;
        }

        /* Hiệu ứng cho nút CTA lớn */
        .cta-button {
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -5px rgba(108, 227, 255, 0.5);
        }

        /* KHẮC PHỤC LỖI: Sửa lại Content Transition */
        /* Ban đầu ẩn và đẩy sang phải */
        .content-transition {
            opacity: 0;
            transform: translateX(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
            position: absolute; /* Quan trọng: Đặt tuyệt đối trong main-container */
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
        }

        /* Khi active: hiện và kéo về vị trí cũ */
        .active-content {
            opacity: 1;
            transform: translateX(0);
            position: relative; /* Sau khi active, đặt lại vị trí tương đối */
        }

        /* Đảm bảo container chính có chiều cao tối thiểu */
        #main-container {
            min-height: 500px; /* Giữ cho footer không bị nhảy lên */
        }
        
        #loading-message {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #loading-message.active {
            opacity: 1;
        }
    </style>
</head>

<body class="dark-mode">
    <div class="max-w-3xl mx-auto p-4 sm:p-8 lg:p-10">

        <!-- Header và Tiêu đề -->
        <header class="text-center mb-10 mt-8">
            <img id="avatar"
                src="https://raw.githubusercontent.com/SFI-Capital/home-page/refs/heads/main/logo1.png"
                onerror="this.onerror=null;this.src='https://placehold.co/96x96/1e293b/0f7aef?text=SFI';"
                alt="Logo SFI Club"
                class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-primary shadow-lg">

            <h1 class="text-4xl font-extrabold text-white mb-2 tracking-tight">
                SFI CLUB - CỘNG ĐỒNG TÀI CHÍNH CHUYÊN NGHIỆP
            </h1>
            <p class="text-xl font-medium text-primary" id="tagline">
                Nơi cung cấp Công cụ và Hệ thống giao dịch chất lượng cao.
            </p>
        </header>

        <!-- Container chứa Nội dung chính và Chi tiết (Sử dụng cho hiệu ứng chuyển trang) -->
        <div id="main-container" class="relative overflow-hidden">

            <!-- MAIN VIEW: Danh sách Công cụ và Hoạt động -->
            <div id="app-container" class="content-transition active-content">

                <!-- SECTION 1: Giới thiệu Chung (Nội dung tĩnh) -->
                <section class="card p-6 md:p-8 rounded-2xl border border-gray-700 mb-10">
                    <img src="https://raw.githubusercontent.com/SFI-Capital/home-page/refs/heads/main/club.jpg"
                        onerror="this.onerror=null;this.src='https://placehold.co/800x200/0f7aef/0f172a?text=SFI+Club+Banner';"
                        alt="Banner SFI Club"
                        class="w-full rounded-xl mb-6 shadow-xl border-2 border-primary/50 object-cover h-auto">

                    <h2 class="text-3xl font-bold mb-4 border-b border-primary/20 pb-2 text-primary">
                        Tối Ưu Lợi Nhuận, Quản Trị Rủi Ro Chuyên Nghiệp
                    </h2>

                    <p class="leading-relaxed text-base font-bold text-white mb-3 mt-4">1. Sứ Mệnh Cộng Đồng:</p>
                    <p class="leading-relaxed text-base text-gray-300 mb-4">SFI CLUB (Safe Financial Investment) là nơi
                        hội tụ các Nhà đầu tư, Traders, IB và MIB có chung mục tiêu phát triển bền vững trong lĩnh vực
                        Tài chính CFDs, đặc biệt là Forex và Giao dịch Vàng. Chúng tôi xây dựng một môi trường nơi sự
                        minh bạch và kỷ luật được đặt lên hàng đầu.</p>

                    <p class="leading-relaxed text-base font-bold text-white mb-3 mt-4">2. Lợi Ích Vượt Trội:</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-300 ml-4 mb-4">
                        <li>
                            <strong class="text-primary">Môi trường Học hỏi Chuyên sâu:</strong> Chia sẻ kinh nghiệm
                            thực chiến và nâng cao kiến thức thông qua các chuyên gia hàng đầu.
                        </li>
                        <li>
                            <strong class="text-primary">Sức mạnh Tập thể:</strong> Kết nối và đồng hành cùng một cộng
                            đồng vững mạnh, nơi mọi thành viên là nguồn lực hỗ trợ lẫn nhau.
                        </li>
                        <li>
                            <strong class="text-primary">Phát triển Bền vững:</strong> Tập trung vào các chiến lược đầu
                            tư an toàn, có kỷ luật, hướng tới mục tiêu tăng trưởng vốn dài hạn.
                        </li>
                    </ul>

                    <p class="leading-relaxed text-base font-bold text-white mb-3 mt-4">3. Tầm Nhìn SFI:</p>
                    <p class="leading-relaxed text-base text-gray-300 mb-6">Chúng tôi cam kết cung cấp những công cụ cốt
                        lõi (Bot & Tín hiệu) và kiến thức cần thiết để mỗi thành viên có thể tự tin làm chủ con đường
                        Đầu tư Tài chính An toàn của mình.</p>
                </section>
                <!-- KẾT THÚC SECTION GIỚI THIỆU CHUNG -->

                <!-- Danh sách Công cụ Cốt lõi (Tải từ API) -->
                <section class="card p-6 md:p-8 rounded-2xl border border-gray-700 mb-10">
                    <h2 class="text-3xl font-bold mb-6 border-b border-primary/20 pb-2 text-primary flex items-center">
                        <i data-lucide="wrench" class="h-6 w-6 mr-2"></i> Công Cụ Cốt Lõi
                    </h2>
                    <div id="tools-list" class="space-y-4">
                        <!-- Dữ liệu Tools sẽ được chèn ở đây -->
                        <p class="text-gray-400 text-center">Đang tải công cụ...</p>
                    </div>
                </section>

                <!-- Hoạt động và Tin tức Cộng đồng (Tải từ API) -->
                <section class="card p-6 md:p-8 rounded-2xl border border-gray-700 mb-10">
                    <h2 class="text-3xl font-bold mb-6 border-b border-primary/20 pb-2 text-primary flex items-center">
                        <i data-lucide="calendar-check" class="h-6 w-6 mr-2"></i> Hoạt Động & Tin Tức
                    </h2>
                    <div id="activities-list" class="space-y-4">
                        <!-- Dữ liệu Activities sẽ được chèn ở đây (Chờ tải từ API) -->
                        <p class="text-gray-400 text-center">Đang tải hoạt động...</p>
                    </div>
                </section>

                <!-- KHU VỰC FORM LEAD MỚI (Đặt ở dưới cùng) -->
                <section class="card p-6 md:p-8 rounded-2xl border border-gray-700 mb-10">
                    <h2 class="text-3xl font-bold mb-6 border-b border-accent/20 pb-2 text-white text-center">
                        <i data-lucide="hand-heart" class="w-7 h-7 inline-block mr-2 text-accent"></i>
                        ĐĂNG KÝ HỖ TRỢ VÀ BOT MIỄN PHÍ
                    </h2>

                    <p class="text-center text-gray-400 mb-6">
                        Vui lòng điền thông tin để chúng tôi liên hệ hỗ trợ bạn **ngay lập tức** và hướng dẫn quy trình tham gia SFI Club.
                    </p>

                    <form id="lead-form" class="space-y-4">
                        <!-- Input Tên -->
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-400 mb-1">Họ và Tên</label>
                            <input type="text" id="name" name="name" required
                                class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-gray-500 focus:ring-primary focus:border-primary transition duration-200"
                                placeholder="Ví dụ: Nguyễn Văn A">
                        </div>

                        <!-- Input Số điện thoại -->
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-400 mb-1">Số điện thoại (Zalo)</label>
                            <input type="tel" id="phone" name="phone" required
                                class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-gray-500 focus:ring-primary focus:border-primary transition duration-200"
                                placeholder="Ví dụ: 0987654321">
                        </div>
                        
                        <!-- Input Câu hỏi/Mong muốn (Tùy chọn) -->
                        <div>
                            <label for="question" class="block text-sm font-medium text-gray-400 mb-1">Câu hỏi/Yêu cầu hỗ trợ (Tùy chọn)</label>
                            <textarea id="question" name="question" rows="2"
                                class="w-full p-3 rounded-lg bg-slate-700 border border-slate-600 text-white placeholder-gray-500 focus:ring-primary focus:border-primary transition duration-200"
                                placeholder="Tôi muốn hỏi về..."></textarea>
                        </div>

                        <!-- Nút Đăng ký Lead - Dùng bg-accent -->
                        <button type="submit" id="submit-button"
                            class="cta-button w-full block bg-accent hover:bg-accent-dark text-gray-900 font-extrabold text-xl py-4 rounded-xl uppercase tracking-wider shadow-lg flex items-center justify-center">
                            <i data-lucide="send" class="w-5 h-5 mr-3"></i>
                            GỬI YÊU CẦU & BẮT ĐẦU QUY TRÌNH
                        </button>
                    </form>

                    <!-- Message Loading/Error -->
                    <div id="loading-message"
                        class="mt-4 p-4 rounded-lg text-center text-lg font-semibold text-note hidden">
                        <i data-lucide="loader-2" class="w-6 h-6 mr-2 inline-block animate-spin"></i>
                        Đang xử lý đăng ký, vui lòng chờ...
                    </div>

                    <p id="error-message" class="mt-4 text-center text-red-400 font-semibold hidden"></p>
                </section>
                <!-- KẾT THÚC KHU VỰC FORM LEAD MỚI -->
            </div>

            <!-- DETAIL VIEW: Trang chi tiết (Mặc định ẩn) -->
            <div id="detail-view" class="content-transition absolute top-0 left-0 right-0 w-full hidden">
                <button onclick="showMainView()"
                    class="mb-6 inline-flex items-center text-primary hover:text-white transition duration-200 text-lg font-semibold">
                    <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i> Quay lại Trang Chủ
                </button>

                <div id="detail-content-container" class="space-y-8">
                    
                    <!-- Chi tiết Công cụ 1 (Bot Bán Tự Động SFI) -->
                    <section id="tool-1-detail" class="detail-content hidden card p-6 md:p-8 rounded-2xl border border-gray-700">
                        <img src="https://raw.githubusercontent.com/SFI-Capital/home-page/refs/heads/main/bot_14.png"
                            onerror="this.onerror=null;this.src='https://placehold.co/800x250/1e293b/0f7aef?text=Bot+Giao+Dich+Tu+Dong';"
                            alt="Hình ảnh Bot Bán Tự Động"
                            class="w-full rounded-xl mb-6 shadow-xl border-2 border-primary/50 object-cover h-auto">

                        <h2 class="text-4xl font-extrabold text-white mb-4">Bot Bán Tự Động SFI</h2>
                        <p class="text-gray-400 mb-6">
                            Hệ thống tự động hóa kỷ luật giao dịch, giúp Quản trị Rủi ro Vốn **24/5**. Bot hoạt động trên nền
                            tảng MT5.
                        </p>
                        <h3 class="text-2xl font-bold text-primary mb-3 flex items-center">
                            <i data-lucide="check-square" class="w-6 h-6 mr-2"></i> Tính năng chính
                        </h3>
                        <ul class="list-disc list-inside space-y-3 text-gray-300 ml-4">
                            <li><strong class="text-white">Quản trị Rủi ro Tự động:</strong> Đặt Stop Loss và Take Profit
                                chính xác theo tỷ lệ R:R cố định, được thực thi tự động.</li>
                            <li><strong class="text-white">Kiểm soát Kỷ luật:</strong> Ngăn chặn giao dịch quá mức (Over
                                Trading) theo ngày/tuần bằng các giới hạn được thiết lập sẵn.</li>
                            <li><strong class="text-white">Tối ưu hóa MT5:</strong> Được thiết kế chuyên biệt cho nền tảng MT5, đảm bảo tốc độ và độ chính xác cao.</li>
                            <li><strong class="text-white">Miễn phí sử dụng:</strong> Bot được cung cấp miễn phí cho thành viên SFI Club (Chỉ trả phí VPS).</li>
                        </ul>
                    </section>
                    
                    <!-- Chi tiết Công cụ 2 (Chuyên Gia Tín Hiệu SFI) -->
                    <section id="tool-2-detail" class="detail-content hidden card p-6 md:p-8 rounded-2xl border border-gray-700">
                        <img src="https://raw.githubusercontent.com/SFI-Capital/home-page/refs/heads/main/Image_Pro%20p7enxwp7enxwp7en.png"
                            onerror="this.onerror=null;this.src='https://placehold.co/800x250/1e293b/0f7aef?text=Bieu+Do+Tin+Hieu+Chuyen+Sau';"
                            alt="Hình ảnh Tín Hiệu Chuyên Gia"
                            class="w-full rounded-xl mb-6 shadow-xl border-2 border-primary/50 object-cover h-auto">
                        
                        <h2 class="text-4xl font-extrabold text-white mb-4">Chuyên Gia Tín Hiệu SFI</h2>
                        <p class="text-gray-400 mb-6">
                            Đội ngũ chuyên gia phân tích kỹ thuật và cơ bản, cung cấp tín hiệu giao dịch chất lượng cao
                            dựa trên xác suất và phân tích đa chiều.
                        </p>
                        <h3 class="text-2xl font-bold text-primary mb-3 flex items-center">
                            <i data-lucide="zap" class="w-6 h-6 mr-2"></i> Lợi ích cốt lõi
                        </h3>
                        <ul class="list-disc list-inside space-y-3 text-gray-300 ml-4">
                            <li><strong class="text-white">Xác định Entry Zone:</strong> Vùng vào lệnh tối ưu, giảm thiểu
                                rủi ro trượt giá và tăng tỷ lệ thành công.</li>
                            <li><strong class="text-white">Phân tích Chuyên sâu:</strong> Tín hiệu đi kèm với giải thích chi tiết về các yếu tố vĩ mô và vi mô.</li>
                            <li><strong class="text-white">Cập nhật Tức thời:</strong> Tín hiệu được gửi đến thành viên qua kênh riêng tư (Discord/Telegram) ngay khi có cơ hội tốt nhất.</li>
                            <li><strong class="text-white">Bảo hiểm Rủi ro:</strong> Chiến lược luôn bao gồm các điểm Stop Loss và Take Profit rõ ràng, giúp bảo vệ vốn.</li>
                        </ul>
                    </section>

                    <!-- Section chi tiết động cho Activities -->
                    <section id="activity-detail-dynamic" class="detail-content hidden card p-6 md:p-8 rounded-2xl border border-gray-700">
                        <h2 id="activity-detail-title" class="text-4xl font-extrabold text-white mb-4">Hoạt động: Đang tải...</h2>
                        <div class="flex items-center text-gray-400 mb-6 border-b border-primary/20 pb-4">
                            <i id="activity-detail-icon" data-lucide="calendar-check" class="w-5 h-5 mr-2 text-primary"></i>
                            <span id="activity-detail-tag" class="text-xs font-medium py-0.5 px-1.5 rounded-full bg-slate-600 text-gray-300 mr-2">N/A</span>
                            <span id="activity-detail-date" class="text-sm">Ngày: N/A</span>
                        </div>
                        
                        <p id="activity-detail-full-description" class="text-gray-300 mb-6 leading-relaxed">
                            Mô tả chi tiết hoạt động sẽ được tải tại đây.
                        </p>

                        <p class="text-primary font-semibold">Vui lòng liên hệ với chuyên viên hỗ trợ của SFI Club để biết thêm chi tiết hoặc đăng ký tham gia!</p>
                        <a href="tel:0869912102" class="text-note hover:text-white font-semibold mt-4 block">Gọi Ngay Hỗ Trợ: Em Lợi</a>
                    </section>

                </div>

            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center pt-8 border-t border-slate-700 mt-10">
            <p class="text-sm text-gray-400">
                Safe Financial Investment!. | © 2025 SFI Capital.
            </p>
        </footer>

    </div>

    <script>
        // --- Hằng số API ---
        const API_BASE_URL = 'https://sfi-automation-api.onrender.com';
        const CONTENT_TOOLS_ENDPOINT = API_BASE_URL + '/api/content/tools';
        const CONTENT_ACTIVITIES_ENDPOINT = API_BASE_URL + '/api/content/activities';
        const STATS_PAGEVIEW_ENDPOINT = API_BASE_URL + '/api/stats/pageview';
        const STATS_LEADS_ENDPOINT = API_BASE_URL + '/api/stats/leads';

        // --- DOM Elements ---
        const appContainer = document.getElementById('app-container');
        const detailView = document.getElementById('detail-view');
        const toolsList = document.getElementById('tools-list');
        const activitiesList = document.getElementById('activities-list');
        const form = document.getElementById('lead-form');
        const submitButton = document.getElementById('submit-button');
        const loadingMessage = document.getElementById('loading-message');
        const errorMessage = document.getElementById('error-message');
        
        // --- DATA STORE (Lưu trữ dữ liệu hoạt động tạm thời) ---
        let loadedActivities = [];

        // --- Hàm Tiện ích ---

        function renderLucideIcons() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Tạo thẻ HTML cho công cụ
        function createToolCard(tool) {
            // Dùng hàm showDetail để mở chi tiết công cụ theo ID
            return `
                <div class="card p-4 rounded-xl border border-gray-700 hover:border-primary transition duration-200 cursor-pointer"
                    onclick="showDetail('tool-${tool.id}')">
                    <div class="flex items-start">
                        <i data-lucide="${tool.icon || 'star'}" class="w-7 h-7 mr-4 text-accent"></i>
                        <div>
                            <h3 class="text-xl font-bold text-white mb-1">${tool.name} <span class="text-sm font-medium ml-2 py-0.5 px-2 rounded-full bg-primary/20 text-primary">${tool.type}</span></h3>
                            <p class="text-gray-400 text-base">${tool.description}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Tạo thẻ HTML cho hoạt động
        function createActivityCard(activity) {
            // Dùng hàm showDetail để mở chi tiết hoạt động theo ID
            return `
                <div class="flex items-center space-x-4 p-3 border-b border-slate-700 last:border-b-0 cursor-pointer"
                    onclick="showDetail('activity-${activity.id}')">
                    <i data-lucide="${activity.icon || 'calendar'}" class="w-6 h-6 text-primary flex-shrink-0"></i>
                    <div class="flex-grow">
                        <p class="text-base font-semibold text-white">${activity.title} <span class="text-xs font-medium py-0.5 px-1.5 rounded-full bg-slate-600 text-gray-300 ml-2">${activity.tag}</span></p>
                        <p class="text-sm text-gray-400">${activity.description.substring(0, 50)}...</p>
                    </div>
                    <p class="text-xs text-gray-500 flex-shrink-0">${activity.date}</p>
                </div>
            `;
        }


        // --- Logic Hiển thị ---
        
        // Cập nhật nội dung chi tiết cho hoạt động động
        function updateActivityDetail(activity) {
            const container = document.getElementById('activity-detail-dynamic');
            
            if (container) {
                document.getElementById('activity-detail-title').textContent = activity.title;
                document.getElementById('activity-detail-tag').textContent = activity.tag;
                document.getElementById('activity-detail-date').textContent = `Ngày: ${activity.date}`;
                document.getElementById('activity-detail-full-description').innerHTML = activity.description;
                
                // Cập nhật Icon Lucide cho Section Hoạt động
                const iconElement = document.getElementById('activity-detail-icon');
                if(iconElement && lucide.icons[activity.icon]) {
                    // Đặt lại innerHTML của icon element để Lucide có thể render lại SVG
                    iconElement.innerHTML = lucide.icons[activity.icon].contents;
                    iconElement.setAttribute('data-lucide', activity.icon);
                } else if (iconElement) {
                    iconElement.setAttribute('data-lucide', 'calendar-check');
                }
            }
        }

        // Hiển thị trang chủ (Danh sách)
        function showMainView() {
            // 1. Kích hoạt transition ẩn cho Detail View
            detailView.classList.remove('active-content');
            detailView.classList.add('content-transition');

            // 2. Sau khi transition hoàn tất (400ms), ẩn thật sự và hiển thị Main View
            setTimeout(() => {
                detailView.classList.add('hidden');
                detailView.style.position = 'absolute'; // Đặt lại vị trí tuyệt đối

                appContainer.classList.remove('hidden');
                appContainer.classList.remove('content-transition');
                appContainer.classList.add('active-content');
                appContainer.style.position = 'relative'; // Đặt lại vị trí tương đối
            }, 400); 
        }

        // Hiển thị trang chi tiết
        function showDetail(contentId) { 
            // 1. Kích hoạt transition ẩn cho Main View
            appContainer.classList.remove('active-content');
            appContainer.classList.add('content-transition');

            const isActivity = contentId.startsWith('activity-');
            const itemId = parseInt(contentId.split('-')[1]); 

            // Xử lý nạp nội dung động nếu là Hoạt động
            if (isActivity) {
                const activity = loadedActivities.find(a => a.id === itemId);
                if (activity) {
                    updateActivityDetail(activity);
                    // Đặt contentId là ID chung cho section dynamic
                    contentId = 'activity-detail-dynamic'; 
                } else {
                    // Xử lý khi không tìm thấy hoạt động
                    alert('Không tìm thấy chi tiết hoạt động này.');
                    return; 
                }
            }


            // 2. Thiết lập Detail View:
            detailView.classList.remove('hidden');
            detailView.style.position = 'absolute';

            // 3. Ẩn tất cả detail sections
            document.querySelectorAll('.detail-content').forEach(content => {
                content.classList.add('hidden');
                content.classList.remove('active-content');
            });

            // 4. Hiển thị specific detail section
            const activeDetail = document.getElementById(contentId);
            if (activeDetail) {
                activeDetail.classList.remove('hidden');
                
                // 5. Sau khi Main View ẩn (400ms), kích hoạt hiển thị Detail View
                setTimeout(() => {
                    appContainer.classList.add('hidden'); // Ẩn hẳn Main View

                    detailView.classList.add('active-content');
                    detailView.classList.remove('content-transition');
                    detailView.style.position = 'relative'; // Quan trọng: Đặt lại tương đối để chiếm không gian
                    
                    activeDetail.classList.add('active-content'); // Kích hoạt transition cho nội dung
                    
                    renderLucideIcons();
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                }, 400); 
            }
        }


        // --- Logic Kết nối API ---

        // 1. Ghi nhận lượt xem Trang (PageView)
        async function trackPageView() {
            try {
                // Sử dụng GET /api/stats/pageview (theo cấu hình stats.js đã fetch)
                await fetch(STATS_PAGEVIEW_ENDPOINT, { method: 'GET' }); 
            } catch (error) {
                // console.error('Lỗi khi ghi nhận lượt xem:', error);
            }
        }

        // 2. Tải Dữ liệu Nội dung (Tools & Activities)
        async function loadContent() {
            toolsList.innerHTML = '<p class="text-gray-400 text-center">Đang tải công cụ...</p>';
            activitiesList.innerHTML = '<p class="text-gray-400 text-center">Đang tải hoạt động...</p>';

            try {
                // Tải Tools
                const toolsResponse = await fetch(CONTENT_TOOLS_ENDPOINT);
                const tools = await toolsResponse.json();
                toolsList.innerHTML = tools.map(createToolCard).join('');

                // Tải Activities
                const activitiesResponse = await fetch(CONTENT_ACTIVITIES_ENDPOINT);
                loadedActivities = await activitiesResponse.json(); // LƯU VÀO BIẾN TẠM THỜI
                
                if (loadedActivities.length > 0) {
                    activitiesList.innerHTML = loadedActivities.map(createActivityCard).join('');
                } else {
                    activitiesList.innerHTML = `
                        <div class="p-4 bg-slate-700 rounded-xl border border-slate-600 text-center">
                            <i data-lucide="info" class="w-6 h-6 inline-block text-note mb-2"></i>
                            <p class="text-gray-300 font-semibold">Hiện chưa có hoạt động nào mới. Vui lòng quay lại sau!</p>
                        </div>
                    `;
                }


                renderLucideIcons();

            } catch (error) {
                toolsList.innerHTML = '<p class="text-red-400 text-center">Lỗi tải dữ liệu Tools. Vui lòng kiểm tra API.</p>';
                activitiesList.innerHTML = '<p class="text-red-400 text-center">Lỗi tải dữ liệu Activities. Vui lòng kiểm tra API.</p>';
                // console.error('Lỗi khi tải nội dung:', error);
            }
        }

        // 3. Xử lý Đăng ký Lead (Form Submit)
        async function handleLeadSubmit(event) {
            event.preventDefault();

            submitButton.disabled = true;
            loadingMessage.classList.remove('hidden');
            loadingMessage.classList.add('active');
            errorMessage.classList.add('hidden');

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const question = document.getElementById('question').value;

            const payload = {
                name: name,
                phone: phone,
                question: question || 'Không có câu hỏi cụ thể.',
                source_page: 'LandingPage_index_html' 
            };

            try {
                const response = await fetch(STATS_LEADS_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();

                if (response.ok) {
                    // Thành công: Chuyển hướng đến trang hướng dẫn
                    const redirectUrl = data.redirect_url; 
                    
                    // Lấy lead_id từ URL BE trả về (ví dụ: /2.html?lead_id=1)
                    const urlParams = new URLSearchParams(redirectUrl.split('?')[1]);
                    const leadId = urlParams.get('lead_id');

                    // Dùng tên file guide_process.html đã thống nhất
                    const fullRedirectUrl = `guide_process.html?lead_id=${leadId}`; 
                    
                    loadingMessage.innerHTML = '<i data-lucide="check-circle" class="w-6 h-6 mr-2 inline-block text-note"></i> Đăng ký thành công! Đang chuyển hướng...';
                    renderLucideIcons();

                    setTimeout(() => {
                        window.location.href = fullRedirectUrl;
                    }, 1500); 

                } else {
                    errorMessage.textContent = data.message || 'Lỗi không xác định từ máy chủ. Vui lòng thử lại.';
                    errorMessage.classList.remove('hidden');
                }
            } catch (error) {
                errorMessage.textContent = 'Lỗi kết nối mạng. Vui lòng kiểm tra API hoặc mạng của bạn.';
                errorMessage.classList.remove('hidden');
                // console.error('Fetch Error:', error);
            } finally {
                if (!loadingMessage.innerHTML.includes('Đăng ký thành công')) {
                    submitButton.disabled = false;
                    loadingMessage.classList.add('hidden');
                    loadingMessage.classList.remove('active');
                }
            }
        }


        // --- Khởi tạo ---
        window.onload = function () {
            // 1. Ghi nhận lượt xem trang
            trackPageView();
            // 2. Tải nội dung Tools & Activities
            loadContent();
            // 3. Lắng nghe sự kiện submit form
            form.addEventListener('submit', handleLeadSubmit);
            // 4. Đảm bảo Main View luôn là mặc định khi tải trang và icons được render
            appContainer.classList.add('active-content');
            detailView.classList.add('hidden');
            renderLucideIcons();
        };

    </script>
</body>

</html>
